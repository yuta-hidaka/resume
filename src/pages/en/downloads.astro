---
import Layout from '../../layouts/Layout.astro';
import DocumentSection from '../../components/DocumentSection.astro';
import DocumentDownloadScripts from '../../components/DocumentDownloadScripts.astro';

// Check if we're in PDF generation mode (for server-side rendering)
const url = new URL(Astro.request.url);
const pdfMode = url.searchParams.get('pdf');
---

{!pdfMode && (
  <Layout title="CV Download - Yuta Hidaka">
    <div class="space-y-8">
      <!-- Page Header -->
      <header class="glass-card p-8 text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-[var(--text-primary)] mb-2">
          Downloads
        </h1>
        <p class="text-[var(--text-muted)]">
          Download CV & Resume
        </p>
      </header>
      
      <DocumentSection
        id="en-resume"
        title="Resume (English)"
        sourcePath="docs/resume/resume-en.md"
        downloadFileName="yuta-hidaka-resume-en.pdf"
        previewHeight="750px"
        isMarkdown={true}
      />
      
      <DocumentSection
        id="en-cv"
        title="CV (English)"
        sourcePath="docs/resume/en-cv.html"
        assetBase="/docs/resume/en-cv/"
        downloadFileName="yuta-hidaka-cv-en.pdf"
        previewHeight="750px"
        fallbackPdfUrl="/yuta-hidaka-resume-english.pdf"
      />
      
    </div>
    <DocumentDownloadScripts />
  </Layout>
)}

{pdfMode && (
  <!-- PDF generation mode - minimal layout for puppeteer -->
  <html lang="en">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width" />
      <title>PDF Generation</title>
      <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+JP:wght@300;400;500;600;700;800&display=swap');
        
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
        
        body {
          margin: 0;
          padding: 0;
          background: white;
          font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }

        @page {
          size: A4;
          margin: 0;
        }

        .pdf-container {
          width: 210mm;
          min-height: 297mm;
          padding: 15mm;
          background: white;
          margin: 0 auto;
        }
      </style>
    </head>
    <body>
      <div class="pdf-container">
        {pdfMode === 'en-resume' && (
          <DocumentSection
            id="en-resume"
            title="Resume (English)"
            sourcePath="docs/resume/resume-en.md"
            downloadFileName="yuta-hidaka-resume-en.pdf"
            previewHeight="auto"
            isMarkdown={true}
          />
        )}
        {pdfMode === 'en-cv' && (
          <DocumentSection
            id="en-cv"
            title="CV (English)"
            sourcePath="docs/resume/en-cv.html"
            assetBase="/docs/resume/en-cv/"
            downloadFileName="yuta-hidaka-cv-en.pdf"
            previewHeight="auto"
          />
        )}
      </div>
    </body>
  </html>
)}
